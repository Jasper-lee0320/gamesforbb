<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèÉ‚Äç‚ôÄÔ∏è ËììËììÁöÑË∑ëÈÖ∑ÂÜíÈô©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(45deg, #ff6b9d, #c44569, #f8b500, #ff6b9d);
            background-size: 400% 400%;
            animation: gradientShift 8s ease infinite;
            color: white;
            margin: 0;
            padding: 0;
            overflow: hidden;
            user-select: none;
            height: 100vh;
            width: 100vw;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        .game-ui {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            min-width: 200px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        }
        
        .game-ui h2 {
            margin-bottom: 10px;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .stats {
            display: flex;
            flex-direction: column;
            gap: 5px;
            font-size: 14px;
            color: #fff;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .game-world {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
        }
        
        .background {
            position: fixed;
            top: 0;
            left: 0;
            width: 200vw;
            height: 100vh;
            background: linear-gradient(to bottom, 
                rgba(255, 182, 193, 0.3) 0%, 
                rgba(255, 105, 180, 0.2) 50%, 
                rgba(255, 20, 147, 0.1) 100%);
            animation: scrollBackground 20s linear infinite;
            z-index: 1;
        }
        
        @keyframes scrollBackground {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }
        
        .ground {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 200vw;
            height: 100px;
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            border-top: 5px solid #fff;
            animation: scrollGround 8s linear infinite;
            z-index: 10;
        }
        
        @keyframes scrollGround {
            from { transform: translateX(0); }
            to { transform: translateX(-50%); }
        }
        
        .player {
            position: absolute;
            left: 100px;
            bottom: 150px;
            width: 50px;
            height: 50px;
            font-size: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            transition: all 0.1s ease;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }
        
        .player.jumping {
            animation: jump 0.6s ease-in-out;
        }
        
        @keyframes jump {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-150px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }
        
        .player.sliding {
            animation: slide 0.8s ease-in-out;
        }
        
        @keyframes slide {
            0% { transform: scaleY(1) scaleX(1); }
            50% { transform: scaleY(0.5) scaleX(1.5); }
            100% { transform: scaleY(1) scaleX(1); }
        }
        
        .obstacle {
            position: absolute;
            bottom: 100px;
            font-size: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 40;
            animation: moveObstacle 4s linear forwards;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }
        
        .obstacle.high {
            bottom: 180px;
        }
        
        @keyframes moveObstacle {
            from { right: -60px; }
            to { right: 100vw; }
        }
        
        .collectible {
            position: absolute;
            bottom: 150px;
            font-size: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 40;
            animation: moveCollectible 5s linear forwards, float 1s ease-in-out infinite alternate;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
        }
        
        .collectible.high {
            bottom: 250px;
        }
        
        @keyframes moveCollectible {
            from { right: -40px; }
            to { right: 100vw; }
        }
        
        @keyframes float {
            from { transform: translateY(0px); }
            to { transform: translateY(-10px); }
        }
        
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 60;
            font-size: 20px;
            animation: particleFloat 1s ease-out forwards;
        }
        
        @keyframes particleFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-100px) scale(0.5);
            }
        }
        
        .score-popup {
            position: absolute;
            z-index: 70;
            font-size: 18px;
            font-weight: bold;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: scoreFloat 1s ease-out forwards;
            pointer-events: none;
        }
        
        @keyframes scoreFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.2);
            }
        }
        
        .power-meter {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 200px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            border: 2px solid #fff;
            overflow: hidden;
            z-index: 100;
        }
        
        .power-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: linear-gradient(to top, #ff1493, #ff69b4, #ffb6c1);
            border-radius: 8px;
            transition: height 0.2s ease;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            color: #ff1493;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 200;
            display: none;
        }
        
        .restart-btn {
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 20, 147, 0.4);
        }
        
        .achievements {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 15px;
            min-width: 200px;
            z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .achievement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
            font-size: 12px;
            opacity: 0.6;
        }
        
        .achievement.unlocked {
            opacity: 1;
            animation: achievementUnlock 0.5s ease-out;
        }
        
        @keyframes achievementUnlock {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <script>
        console.log('üöÄ È°µÈù¢ÂºÄÂßãÂä†ËΩΩ - beibei-parkour-adventure.html');
        console.log('üì± Á™óÂè£Â∞∫ÂØ∏:', window.innerWidth, 'x', window.innerHeight);
        console.log('üìÑ ÊñáÊ°£Â∞±Áª™Áä∂ÊÄÅ:', document.readyState);
    </script>
    
    <div class="game-container">
        <script>console.log('üéÆ ÂàõÂª∫game-container');</script>
        
        <div class="game-ui">
            <script>console.log('üéØ ÂàõÂª∫game-ui');</script>
            <h2>üèÉ‚Äç‚ôÄÔ∏è ËììËììË∑ëÈÖ∑</h2>
            <div class="stats">
                <div>üíñ ÁîüÂëΩ: <span id="lives">3</span></div>
                <div>üåü ÂàÜÊï∞: <span id="score">0</span></div>
                <div>üíé ÈíªÁü≥: <span id="gems">0</span></div>
                <div>üìè Ë∑ùÁ¶ª: <span id="distance">0</span>m</div>
                <div>‚ö° ËÉΩÈáè: <span id="energy">100</span>%</div>
            </div>
        </div>
        
        <div class="achievements">
            <script>console.log('üèÜ ÂàõÂª∫achievementsÈù¢Êùø');</script>
            <h3>üèÜ ÊàêÂ∞±</h3>
            <div class="achievement" id="firstRun">
                <span>üåü</span>
                <span>ÂàùÊ¨°Â•îË∑ë</span>
            </div>
            <div class="achievement" id="collector">
                <span>üíé</span>
                <span>ÈíªÁü≥Êî∂ËóèÂÆ∂</span>
            </div>
            <div class="achievement" id="jumper">
                <span>ü¶ò</span>
                <span>Ë∑≥Ë∑ÉÂ§ßÂ∏à</span>
            </div>
            <div class="achievement" id="survivor">
                <span>üí™</span>
                <span>ÁîüÂ≠ò‰∏ìÂÆ∂</span>
            </div>
            <div class="achievement" id="speedster">
                <span>‚ö°</span>
                <span>ÈÄüÂ∫¶‰πãÁéã</span>
            </div>
        </div>
        
        <div class="power-meter">
            <script>console.log('‚ö° ÂàõÂª∫power-meter');</script>
            <div class="power-fill" id="powerFill"></div>
        </div>
        
        <div class="controls">
            <script>console.log('üéÆ ÂàõÂª∫controlsÈù¢Êùø');</script>
            <div id="startControls">
                <button class="restart-btn" onclick="startGame()" style="margin-bottom: 10px;">üéÆ ÂºÄÂßãÊ∏∏Êàè</button>
            </div>
            <div id="gameControls" style="display: none;">
                <div>üéÆ ÊéßÂà∂ÊñπÊ≥ï:</div>
                <div>Á©∫Ê†ºÈîÆ/ÁÇπÂáª = Ë∑≥Ë∑É | ‰∏ãÁÆ≠Â§¥/Âêë‰∏ãÊªë = ÊªëÈì≤</div>
                <div>Êî∂ÈõÜüíéÈíªÁü≥ÔºåÈÅøÂºÄüößÈöúÁ¢çÁâ©ÔºÅ</div>
            </div>
        </div>
        
        <div class="game-world">
            <script>console.log('üåç ÂàõÂª∫game-world');</script>
            <div class="background"></div>
            <div class="ground"></div>
            <div class="player" id="player">üèÉ‚Äç‚ôÄÔ∏è</div>
            <script>console.log('üë§ ÂàõÂª∫playerÂÖÉÁ¥†');</script>
        </div>
        
        <div class="game-over" id="gameOver">
            <h2>üéÆ Ê∏∏ÊàèÁªìÊùü</h2>
            <div id="finalStats"></div>
            <button class="restart-btn" onclick="restartGame()">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
        </div>
    </div>

    <script>
        console.log('üéÆ ÂºÄÂßãÊâßË°å‰∏ªJavaScript‰ª£Á†Å');
        
        // Ê£ÄÊü•ÂÖ≥ÈîÆÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
        function checkElements() {
            const elements = [
                'player', 'lives', 'score', 'gems', 'distance', 'energy',
                'powerFill', 'startControls', 'gameControls'
            ];
            
            console.log('üîç Ê£ÄÊü•È°µÈù¢ÂÖÉÁ¥†:');
            console.log('üñ•Ô∏è ËßÜÂè£Â∞∫ÂØ∏:', window.innerWidth, 'x', window.innerHeight);
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`  ${id}:`, element ? '‚úÖ Â≠òÂú®' : '‚ùå ‰∏çÂ≠òÂú®');
                if (element) {
                    const rect = element.getBoundingClientRect();
                    console.log(`    ‰ΩçÁΩÆ: (${rect.left}, ${rect.top}) Â∞∫ÂØ∏: ${rect.width}x${rect.height}`);
                    console.log(`    ÂèØËßÅÊÄß: display=${getComputedStyle(element).display}, visibility=${getComputedStyle(element).visibility}`);
                    
                    // ÁâπÊÆäÂ§ÑÁêÜplayerÂÖÉÁ¥†
                    if (id === 'player') {
                        const computedStyle = getComputedStyle(element);
                        console.log(`    PlayerËØ¶ÁªÜ‰ø°ÊÅØ:`);
                        console.log(`      position: ${computedStyle.position}`);
                        console.log(`      left: ${computedStyle.left}`);
                        console.log(`      bottom: ${computedStyle.bottom}`);
                        console.log(`      top: ${computedStyle.top}`);
                        console.log(`      Áà∂ÂÆπÂô®È´òÂ∫¶: ${element.parentElement.offsetHeight}px`);
                        
                        // Â∞ùËØïÂº∫Âà∂ËÆæÁΩÆ‰ΩçÁΩÆ
                        if (rect.top > window.innerHeight - 200) {
                            console.log('üîß Player‰ΩçÁΩÆÂºÇÂ∏∏ÔºåÂ∞ùËØï‰øÆÂ§ç...');
                            element.style.position = 'fixed';
                            element.style.left = '100px';
                            element.style.bottom = '150px';
                            element.style.top = 'auto';
                        }
                    }
                }
            });
        }
        
        // Ê∏∏ÊàèÁä∂ÊÄÅ
        const gameState = {
            isPlaying: true,
            lives: 3,
            score: 0,
            gems: 0,
            distance: 0,
            energy: 100,
            speed: 1,
            gameTime: 0,
            isJumping: false,
            isSliding: false,
            jumpCount: 0,
            gemsCollected: 0,
            obstaclesAvoided: 0
        };
        
        // ÊàêÂ∞±Á≥ªÁªü
        const achievements = {
            firstRun: { unlocked: false, name: 'ÂàùÊ¨°Â•îË∑ë', desc: 'ÂºÄÂßã‰Ω†ÁöÑÁ¨¨‰∏ÄÊ¨°Ë∑ëÈÖ∑ÂÜíÈô©' },
            collector: { unlocked: false, name: 'ÈíªÁü≥Êî∂ËóèÂÆ∂', desc: 'Êî∂ÈõÜ10‰∏™ÈíªÁü≥' },
            jumper: { unlocked: false, name: 'Ë∑≥Ë∑ÉÂ§ßÂ∏à', desc: 'Ë∑≥Ë∑É50Ê¨°' },
            survivor: { unlocked: false, name: 'ÁîüÂ≠ò‰∏ìÂÆ∂', desc: 'Ë∑ëËøá500Á±≥' },
            speedster: { unlocked: false, name: 'ÈÄüÂ∫¶‰πãÁéã', desc: 'ËææÂà∞ÊúÄÈ´òÈÄüÂ∫¶' }
        };
        
        // Èü≥ÊïàÁ≥ªÁªü
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                switch(type) {
                    case 'jump':
                        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(600, audioContext.currentTime + 0.2);
                        break;
                    case 'collect':
                        oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.1);
                        break;
                    case 'hit':
                        oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.3);
                        break;
                    case 'slide':
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                        oscillator.frequency.linearRampToValueAtTime(150, audioContext.currentTime + 0.5);
                        break;
                }
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start();
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (e) {
                console.log('üîä Èü≥ÊïàÊí≠ÊîæÂ§±Ë¥•:', e);
            }
        }
        
        // ÂºÄÂßãÊ∏∏Êàè
        function startGame() {
            console.log('üéÆ Áî®Êà∑ÁÇπÂáªÂºÄÂßãÊ∏∏Êàè');
            
            // ÊøÄÊ¥ªÈü≥È¢ë‰∏ä‰∏ãÊñá
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            // ÈöêËóèÂºÄÂßãÊåâÈíÆÔºåÊòæÁ§∫Ê∏∏ÊàèÊéßÂà∂ËØ¥Êòé
            document.getElementById('startControls').style.display = 'none';
            document.getElementById('gameControls').style.display = 'block';
            
            // ÂºÄÂßãÊ∏∏Êàè
            initGame();
        }
        
        // ÂàùÂßãÂåñÊ∏∏Êàè
        function initGame() {
            console.log('üéÆ ÂàùÂßãÂåñËììËììË∑ëÈÖ∑Ê∏∏Êàè');
            updateUI();
            unlockAchievement('firstRun');
            startGameLoop();
        }
        
        // Êõ¥Êñ∞UI
        function updateUI() {
            console.log('üîÑ Êõ¥Êñ∞UIÔºåÂΩìÂâçÊ∏∏ÊàèÁä∂ÊÄÅ:', gameState);
            
            try {
                document.getElementById('lives').textContent = gameState.lives;
                document.getElementById('score').textContent = gameState.score;
                document.getElementById('gems').textContent = gameState.gems;
                document.getElementById('distance').textContent = Math.floor(gameState.distance);
                document.getElementById('energy').textContent = Math.floor(gameState.energy);
                document.getElementById('powerFill').style.height = gameState.energy + '%';
                
                console.log('‚úÖ UIÊõ¥Êñ∞ÊàêÂäü');
            } catch (error) {
                console.error('‚ùå UIÊõ¥Êñ∞Â§±Ë¥•:', error);
            }
        }
        
        // Áé©ÂÆ∂ÊéßÂà∂
        const player = document.getElementById('player');
        
        function jump() {
            if (!gameState.isPlaying || gameState.isJumping || gameState.energy < 20) return;
            
            console.log('ü¶ò ËììËììË∑≥Ë∑É!');
            gameState.isJumping = true;
            gameState.jumpCount++;
            gameState.energy -= 20;
            
            player.classList.add('jumping');
            playSound('jump');
            createParticles(player.offsetLeft + 25, player.offsetTop + 25, '‚ú®');
            
            setTimeout(() => {
                gameState.isJumping = false;
                player.classList.remove('jumping');
            }, 600);
            
            // Ê£ÄÊü•Ë∑≥Ë∑ÉÊàêÂ∞±
            if (gameState.jumpCount >= 50) {
                unlockAchievement('jumper');
            }
        }
        
        function slide() {
            if (!gameState.isPlaying || gameState.isSliding || gameState.energy < 15) return;
            
            console.log('üèÉ‚Äç‚ôÄÔ∏è ËììËììÊªëÈì≤!');
            gameState.isSliding = true;
            gameState.energy -= 15;
            
            player.classList.add('sliding');
            player.innerHTML = 'ü§∏‚Äç‚ôÄÔ∏è';
            playSound('slide');
            createParticles(player.offsetLeft + 25, player.offsetTop + 25, 'üí®');
            
            setTimeout(() => {
                gameState.isSliding = false;
                player.classList.remove('sliding');
                player.innerHTML = 'üèÉ‚Äç‚ôÄÔ∏è';
            }, 800);
        }
        
        // ‰∫ã‰ª∂ÁõëÂê¨
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' || e.code === 'ArrowUp') {
                e.preventDefault();
                jump();
            } else if (e.code === 'ArrowDown') {
                e.preventDefault();
                slide();
            }
        });
        
        // Ëß¶Êë∏ÊéßÂà∂
        let touchStartY = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartY = e.touches[0].clientY;
        });
        
        document.addEventListener('touchmove', (e) => {
            e.preventDefault();
        });
        
        document.addEventListener('touchend', (e) => {
            const touchEndY = e.changedTouches[0].clientY;
            const diff = touchStartY - touchEndY;
            
            if (Math.abs(diff) > 30) {
                if (diff > 0) {
                    jump(); // Âêë‰∏äÊªëÂä®Ë∑≥Ë∑É
                } else {
                    slide(); // Âêë‰∏ãÊªëÂä®ÊªëÈì≤
                }
            } else {
                jump(); // ÁÇπÂáªË∑≥Ë∑É
            }
        });
        
        // ÁîüÊàêÈöúÁ¢çÁâ©
        function createObstacle() {
            if (!gameState.isPlaying) return;
            
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            
            const types = ['üöß', 'ü™®', '‚ö°', 'üåµ', 'üî•'];
            const isHigh = Math.random() > 0.7;
            
            if (isHigh) {
                obstacle.classList.add('high');
                obstacle.innerHTML = 'ü¶Ö'; // È´òÁ©∫ÈöúÁ¢ç
            } else {
                obstacle.innerHTML = types[Math.floor(Math.random() * types.length)];
            }
            
            document.querySelector('.game-world').appendChild(obstacle);
            
            console.log('üöß ÁîüÊàêÈöúÁ¢çÁâ©:', obstacle.innerHTML, isHigh ? '(È´òÁ©∫)' : '(Âú∞Èù¢)');
            
            // Á¢∞ÊíûÊ£ÄÊµã
            const checkCollision = setInterval(() => {
                if (!document.body.contains(obstacle)) {
                    clearInterval(checkCollision);
                    return;
                }
                
                const obstacleRect = obstacle.getBoundingClientRect();
                const playerRect = player.getBoundingClientRect();
                
                if (obstacleRect.right >= playerRect.left && 
                    obstacleRect.left <= playerRect.right &&
                    obstacleRect.bottom >= playerRect.top && 
                    obstacleRect.top <= playerRect.bottom) {
                    
                    // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÈÅøÂÖçÁ¢∞Êíû
                    const canAvoid = (isHigh && !gameState.isJumping) || 
                                   (!isHigh && (gameState.isJumping || gameState.isSliding));
                    
                    if (!canAvoid) {
                        console.log('üí• ËììËììÊíûÂà∞ÈöúÁ¢çÁâ©!');
                        hitObstacle();
                        clearInterval(checkCollision);
                    } else {
                        console.log('‚úÖ ÊàêÂäüÈÅøÂºÄÈöúÁ¢çÁâ©!');
                        gameState.obstaclesAvoided++;
                        gameState.score += 20;
                        showScorePopup(playerRect.left, playerRect.top, '+20');
                    }
                }
            }, 16);
            
            // Ê∏ÖÁêÜÈöúÁ¢çÁâ©
            setTimeout(() => {
                if (document.body.contains(obstacle)) {
                    obstacle.remove();
                    clearInterval(checkCollision);
                }
            }, 4000);
        }
        
        // ÁîüÊàêÊî∂ÈõÜÂìÅ
        function createCollectible() {
            if (!gameState.isPlaying) return;
            
            const collectible = document.createElement('div');
            collectible.className = 'collectible';
            
            const types = ['üíé', 'üåü', 'üíñ', '‚ö°', 'üçì'];
            const isHigh = Math.random() > 0.5;
            
            if (isHigh) {
                collectible.classList.add('high');
            }
            
            collectible.innerHTML = types[Math.floor(Math.random() * types.length)];
            document.querySelector('.game-world').appendChild(collectible);
            
            console.log('üíé ÁîüÊàêÊî∂ÈõÜÂìÅ:', collectible.innerHTML, isHigh ? '(È´òÁ©∫)' : '(‰ΩéÁ©∫)');
            
            // Êî∂ÈõÜÊ£ÄÊµã
            const checkCollection = setInterval(() => {
                if (!document.body.contains(collectible)) {
                    clearInterval(checkCollection);
                    return;
                }
                
                const collectibleRect = collectible.getBoundingClientRect();
                const playerRect = player.getBoundingClientRect();
                
                if (collectibleRect.right >= playerRect.left && 
                    collectibleRect.left <= playerRect.right &&
                    collectibleRect.bottom >= playerRect.top && 
                    collectibleRect.top <= playerRect.bottom) {
                    
                    console.log('üåü Êî∂ÈõÜÂà∞:', collectible.innerHTML);
                    collectItem(collectible);
                    clearInterval(checkCollection);
                }
            }, 16);
            
            // Ê∏ÖÁêÜÊî∂ÈõÜÂìÅ
            setTimeout(() => {
                if (document.body.contains(collectible)) {
                    collectible.remove();
                    clearInterval(checkCollection);
                }
            }, 5000);
        }
        
        // Êî∂ÈõÜÁâ©ÂìÅ
        function collectItem(item) {
            const itemType = item.innerHTML;
            let points = 0;
            
            switch(itemType) {
                case 'üíé':
                    gameState.gems++;
                    points = 50;
                    gameState.gemsCollected++;
                    break;
                case 'üåü':
                    points = 30;
                    break;
                case 'üíñ':
                    if (gameState.lives < 5) gameState.lives++;
                    points = 25;
                    break;
                case '‚ö°':
                    gameState.energy = Math.min(100, gameState.energy + 30);
                    points = 20;
                    break;
                case 'üçì':
                    points = 15;
                    break;
            }
            
            gameState.score += points;
            playSound('collect');
            createParticles(item.offsetLeft, item.offsetTop, itemType);
            showScorePopup(item.offsetLeft, item.offsetTop, '+' + points);
            item.remove();
            
            // Ê£ÄÊü•ÈíªÁü≥Êî∂ÈõÜÊàêÂ∞±
            if (gameState.gemsCollected >= 10) {
                unlockAchievement('collector');
            }
        }
        
        // ÊíûÂáªÈöúÁ¢çÁâ©
        function hitObstacle() {
            gameState.lives--;
            gameState.energy = Math.max(0, gameState.energy - 30);
            playSound('hit');
            
            // Áé©ÂÆ∂Èó™ÁÉÅÊïàÊûú
            player.style.animation = 'none';
            player.style.opacity = '0.5';
            setTimeout(() => {
                player.style.opacity = '1';
            }, 1000);
            
            createParticles(player.offsetLeft + 25, player.offsetTop + 25, 'üí•');
            
            if (gameState.lives <= 0) {
                endGame();
            }
        }
        
        // ÂàõÂª∫Á≤íÂ≠êÊïàÊûú
        function createParticles(x, y, emoji) {
            for (let i = 0; i < 5; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.innerHTML = emoji;
                particle.style.left = (x + Math.random() * 40 - 20) + 'px';
                particle.style.top = (y + Math.random() * 40 - 20) + 'px';
                document.body.appendChild(particle);
                
                setTimeout(() => particle.remove(), 1000);
            }
        }
        
        // ÊòæÁ§∫ÂàÜÊï∞ÂºπÁ™ó
        function showScorePopup(x, y, text) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = text;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            document.body.appendChild(popup);
            
            setTimeout(() => popup.remove(), 1000);
        }
        
        // Ëß£ÈîÅÊàêÂ∞±
        function unlockAchievement(id) {
            if (achievements[id] && !achievements[id].unlocked) {
                achievements[id].unlocked = true;
                const element = document.getElementById(id);
                element.classList.add('unlocked');
                
                console.log('üèÜ Ëß£ÈîÅÊàêÂ∞±:', achievements[id].name);
                showScorePopup(window.innerWidth/2, 100, 'üèÜ ' + achievements[id].name);
                playSound('collect');
            }
        }
        
        // Ê∏∏Êàè‰∏ªÂæ™ÁéØ
        function startGameLoop() {
            console.log('üîÑ ÂêØÂä®Ê∏∏ÊàèÂæ™ÁéØ');
            
            const gameLoop = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(gameLoop);
                    return;
                }
                
                // Êõ¥Êñ∞Ê∏∏ÊàèÁä∂ÊÄÅ
                gameState.gameTime += 0.1;
                gameState.distance += gameState.speed;
                gameState.score += Math.floor(gameState.speed);
                
                // ÊÅ¢Â§çËÉΩÈáè
                if (gameState.energy < 100) {
                    gameState.energy += 0.5;
                }
                
                // Â¢ûÂä†ÈÄüÂ∫¶
                if (gameState.gameTime % 10 === 0) {
                    gameState.speed = Math.min(3, gameState.speed + 0.1);
                    if (gameState.speed >= 2.5) {
                        unlockAchievement('speedster');
                    }
                }
                
                // Ê£ÄÊü•Ë∑ùÁ¶ªÊàêÂ∞±
                if (gameState.distance >= 500) {
                    unlockAchievement('survivor');
                }
                
                updateUI();
            }, 100);
            
            // ÁîüÊàêÈöúÁ¢çÁâ©
            const obstacleInterval = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(obstacleInterval);
                    return;
                }
                createObstacle();
            }, 2000 - (gameState.speed * 200));
            
            // ÁîüÊàêÊî∂ÈõÜÂìÅ
            const collectibleInterval = setInterval(() => {
                if (!gameState.isPlaying) {
                    clearInterval(collectibleInterval);
                    return;
                }
                createCollectible();
            }, 1500);
        }
        
        // ÁªìÊùüÊ∏∏Êàè
        function endGame() {
            console.log('üéÆ Ê∏∏ÊàèÁªìÊùü!', {
                finalScore: gameState.score,
                distance: Math.floor(gameState.distance),
                gems: gameState.gems,
                jumps: gameState.jumpCount
            });
            
            gameState.isPlaying = false;
            
            const finalStats = document.getElementById('finalStats');
            finalStats.innerHTML = `
                <p>üåü ÊúÄÁªàÂàÜÊï∞: ${gameState.score}</p>
                <p>üìè Ë∑ëËøáË∑ùÁ¶ª: ${Math.floor(gameState.distance)}Á±≥</p>
                <p>üíé Êî∂ÈõÜÈíªÁü≥: ${gameState.gems}‰∏™</p>
                <p>ü¶ò ÊÄªË∑≥Ë∑ÉÊ¨°Êï∞: ${gameState.jumpCount}Ê¨°</p>
                <p>üöß ÈÅøÂºÄÈöúÁ¢ç: ${gameState.obstaclesAvoided}‰∏™</p>
            `;
            
            document.getElementById('gameOver').style.display = 'block';
        }
        
        // ÈáçÊñ∞ÂºÄÂßãÊ∏∏Êàè
        function restartGame() {
            console.log('üîÑ ÈáçÊñ∞ÂºÄÂßãÊ∏∏Êàè');
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            gameState.isPlaying = true;
            gameState.lives = 3;
            gameState.score = 0;
            gameState.gems = 0;
            gameState.distance = 0;
            gameState.energy = 100;
            gameState.speed = 1;
            gameState.gameTime = 0;
            gameState.isJumping = false;
            gameState.isSliding = false;
            gameState.jumpCount = 0;
            gameState.gemsCollected = 0;
            gameState.obstaclesAvoided = 0;
            
            // Ê∏ÖÁêÜUI
            document.getElementById('gameOver').style.display = 'none';
            player.style.opacity = '1';
            player.innerHTML = 'üèÉ‚Äç‚ôÄÔ∏è';
            player.className = 'player';
            
            // Ê∏ÖÁêÜÊâÄÊúâÂä®ÊÄÅÂÖÉÁ¥†
            document.querySelectorAll('.obstacle, .collectible, .particle, .score-popup').forEach(el => el.remove());
            
            updateUI();
            startGameLoop();
        }
        
        // ÂêØÂä®Ê∏∏Êàè
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìÑ DOMÂÜÖÂÆπÂä†ËΩΩÂÆåÊàê!');
            console.log('üéÆ ËììËììÁöÑË∑ëÈÖ∑ÂÜíÈô©È°µÈù¢Â∞±Áª™');
            
            // Ê£ÄÊü•ÊâÄÊúâÂÖÉÁ¥†
            checkElements();
            
            try {
                // ‰∏çËá™Âä®ÂºÄÂßãÊ∏∏ÊàèÔºåÁ≠âÂæÖÁî®Êà∑ÁÇπÂáªÂºÄÂßãÊåâÈíÆ
                updateUI();
                console.log('‚úÖ ÂàùÂßãÂåñÂÆåÊàêÔºåÁ≠âÂæÖÁî®Êà∑ÂºÄÂßãÊ∏∏Êàè');
            } catch (error) {
                console.error('‚ùå ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        });
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÁöÑÈ¢ùÂ§ñÊ£ÄÊü•
        window.addEventListener('load', () => {
            console.log('üéØ È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩÂÆåÊàê');
            
            // Á¥ßÊÄ•‰øÆÂ§çÔºöÂº∫Âà∂ËÆæÁΩÆÊâÄÊúâÂÖÉÁ¥†‰ΩçÁΩÆ
            emergencyPositionFix();
            
            console.log('üîç ÂÜçÊ¨°Ê£ÄÊü•ÂÖÉÁ¥†Áä∂ÊÄÅ...');
            setTimeout(() => {
                checkElements();
            }, 100);
        });
        
        // Á¥ßÊÄ•‰ΩçÁΩÆ‰øÆÂ§ç
        function emergencyPositionFix() {
            console.log('üö® ÊâßË°åÁ¥ßÊÄ•‰ΩçÁΩÆ‰øÆÂ§ç...');
            
            // Âü∫Êú¨UI‰ΩçÁΩÆ‰øÆÂ§ç
            const fixes = [
                { id: 'player', css: 'position:fixed !important; left:100px !important; bottom:200px !important; z-index:100 !important;' },
                { id: 'startControls', css: 'position:fixed !important; top:60% !important; left:50% !important; transform:translate(-50%,-50%) !important; z-index:1000 !important;' },
                { id: 'gameControls', css: 'position:fixed !important; bottom:40px !important; left:50% !important; transform:translateX(-50%) !important; z-index:1000 !important;' },
                { id: 'lives', css: 'position:fixed !important; top:20px !important; left:20px !important; z-index:1000 !important;' },
                { id: 'score', css: 'position:fixed !important; top:20px !important; right:20px !important; z-index:1000 !important;' },
                { id: 'gems', css: 'position:fixed !important; top:60px !important; left:20px !important; z-index:1000 !important;' },
                { id: 'distance', css: 'position:fixed !important; top:60px !important; right:20px !important; z-index:1000 !important;' },
                { id: 'energy', css: 'position:fixed !important; bottom:120px !important; left:20px !important; z-index:1000 !important;' }
            ];
            
            fixes.forEach(fix => {
                const element = document.getElementById(fix.id);
                if (element) {
                    element.style.cssText = fix.css;
                    console.log(`üîß ‰øÆÂ§ç ${fix.id} ‰ΩçÁΩÆ`);
                }
            });
            
            // ‰øÆÂ§çcanvas
            const canvas = document.getElementById('gameCanvas');
            if (canvas) {
                canvas.style.cssText = 'position:fixed !important; top:0 !important; left:0 !important; width:100vw !important; height:100vh !important; z-index:1 !important;';
                console.log('üîß ‰øÆÂ§ç Canvas ‰ΩçÁΩÆ');
            }
        }
    </script>
</body>
</html>
