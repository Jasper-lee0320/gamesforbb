<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¯ è““è““çš„å°„ç®­æŒ‘æˆ˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #ffb3e6 0%, #ff99d6 50%, #ff80cc 100%);
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            overflow: hidden;
            touch-action: none;
            user-select: none;
        }

        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .game-header {
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        .game-title {
            color: #ff1493;
            font-size: 1.8em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }

        .game-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
            min-width: 80px;
        }

        .stat-label {
            font-size: 12px;
            color: #ff1493;
            font-weight: bold;
        }

        .stat-value {
            font-size: 18px;
            color: #dc143c;
            font-weight: bold;
            background: white;
            padding: 5px 10px;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .game-area {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, #87ceeb 0%, #98fb98 100%);
        }

        .wind-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            z-index: 50;
        }

        .wind-text {
            color: #ff1493;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .wind-arrow {
            font-size: 24px;
            color: #00bfff;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .archer {
            position: absolute;
            bottom: 50px;
            left: 50px;
            width: 60px;
            height: 80px;
            background: linear-gradient(145deg, #ff69b4, #ff1493);
            border-radius: 30px 30px 10px 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            transform-origin: center;
            transition: transform 0.3s ease;
            z-index: 20;
        }

        .bow {
            position: absolute;
            bottom: 65px;
            left: 110px;
            width: 40px;
            height: 60px;
            background: #8b4513;
            border-radius: 20px;
            transform-origin: center;
            transition: transform 0.2s ease;
            z-index: 15;
        }

        .arrow {
            position: absolute;
            width: 60px;
            height: 6px;
            background: linear-gradient(90deg, #cd853f, #daa520, #ff6347);
            border-radius: 3px;
            transform-origin: left center;
            z-index: 30;
            transition: all 0.1s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .arrow::before {
            content: 'â–¶';
            position: absolute;
            right: -12px;
            top: -9px;
            color: #ff1493;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .arrow::after {
            content: '';
            position: absolute;
            left: -8px;
            top: 1px;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 2px 8px 2px 0;
            border-color: transparent #8b4513 transparent transparent;
        }

        .target {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: crosshair;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .target-rings {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            background: 
                radial-gradient(circle, #ff1493 0% 15%, 
                                      #ff69b4 15% 30%, 
                                      #ffb6c1 30% 45%, 
                                      #ffc0cb 45% 60%, 
                                      #ffe4e1 60% 75%, 
                                      #fff 75% 100%);
            border: 3px solid #ff1493;
        }

        .target-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            background: #ff1493;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            font-weight: bold;
        }

        .target.moving {
            animation: targetMove 3s linear infinite;
        }

        @keyframes targetMove {
            0% { transform: translateY(0); }
            25% { transform: translateY(-50px); }
            50% { transform: translateY(-100px); }
            75% { transform: translateY(-50px); }
            100% { transform: translateY(0); }
        }

        .power-meter {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 300px;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            border: 2px solid #ff1493;
            overflow: hidden;
            z-index: 30;
        }

        .power-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #00ff00, #ffff00, #ff6600, #ff0000);
            border-radius: 8px;
            transition: width 0.1s ease;
        }

        .power-text {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            color: #ff1493;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(255,255,255,0.8);
        }

        .crosshair {
            position: absolute;
            width: 30px;
            height: 30px;
            pointer-events: none;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: #ff1493;
            border-radius: 1px;
        }

        .crosshair::before {
            width: 2px;
            height: 30px;
            left: 14px;
            top: 0;
        }

        .crosshair::after {
            width: 30px;
            height: 2px;
            left: 0;
            top: 14px;
        }

        .score-popup {
            position: absolute;
            color: #ff1493;
            font-weight: bold;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(255,255,255,0.8);
            pointer-events: none;
            z-index: 200;
            animation: scoreFloat 2s ease-out forwards;
        }

        @keyframes scoreFloat {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-80px) scale(1.5);
            }
        }

        .controls {
            position: absolute;
            bottom: 60px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 50;
        }

        .control-btn {
            background: linear-gradient(145deg, #ff69b4, #ff1493);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 20, 147, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 20, 147, 0.4);
        }

        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .trajectory-line {
            position: absolute;
            height: 2px;
            background: rgba(255, 20, 147, 0.6);
            border-radius: 1px;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #ff69b4;
            border-radius: 50%;
            pointer-events: none;
            z-index: 25;
            animation: particleFly 1s ease-out forwards;
        }

        @keyframes particleFly {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(var(--dx), var(--dy)) scale(0);
            }
        }

        .achievement-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            z-index: 1000;
            text-align: center;
            display: none;
            animation: achievementShow 0.5s ease-out;
        }

        @keyframes achievementShow {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
            100% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .achievement-title {
            color: #ff1493;
            font-size: 2em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .achievement-desc {
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .game-header {
                padding: 8px 15px;
            }
            
            .game-title {
                font-size: 1.4em;
            }
            
            .game-stats {
                gap: 10px;
            }
            
            .stat-item {
                min-width: 60px;
            }
            
            .stat-value {
                font-size: 14px;
                padding: 3px 8px;
            }
            
            .archer {
                width: 50px;
                height: 70px;
                font-size: 20px;
            }
            
            .bow {
                width: 35px;
                height: 50px;
            }
            
            .target {
                width: 80px;
                height: 80px;
            }
            
            .power-meter {
                width: 250px;
            }
        }

        @media (max-width: 480px) {
            .game-title {
                font-size: 1.2em;
            }
            
            .archer {
                width: 45px;
                height: 60px;
                font-size: 18px;
                left: 30px;
            }
            
            .bow {
                left: 75px;
                width: 30px;
                height: 45px;
            }
            
            .target {
                width: 70px;
                height: 70px;
            }
            
            .power-meter {
                width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="game-title">ğŸ¯ è““è““çš„å°„ç®­æŒ‘æˆ˜</div>
            <div class="game-stats">
                <div class="stat-item">
                    <div class="stat-label">ğŸ¹ ç®­æ•°</div>
                    <div class="stat-value" id="arrowsDisplay">10</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">â­ åˆ†æ•°</div>
                    <div class="stat-value" id="scoreDisplay">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ğŸ¯ å‘½ä¸­</div>
                    <div class="stat-value" id="hitsDisplay">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ğŸ“Š ç²¾åº¦</div>
                    <div class="stat-value" id="accuracyDisplay">0%</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ğŸ† ç­‰çº§</div>
                    <div class="stat-value" id="levelDisplay">1</div>
                </div>
            </div>
        </div>

        <div class="game-area" id="gameArea">
            <div class="wind-indicator">
                <div class="wind-text">ğŸ’¨ é£åŠ›</div>
                <div class="wind-arrow" id="windArrow">â†’</div>
            </div>

            <div class="archer">ğŸ¹</div>
            <div class="bow" id="bow"></div>
            
            <div class="target" id="target">
                <div class="target-rings">
                    <div class="target-center">ğŸ’–</div>
                </div>
            </div>

            <div class="power-meter">
                <div class="power-text">ğŸ”¥ åŠ›åº¦</div>
                <div class="power-fill" id="powerFill"></div>
            </div>

            <div class="crosshair" id="crosshair"></div>
            <div class="trajectory-line" id="trajectoryLine"></div>

            <div class="controls">
                <button class="control-btn" onclick="newGame()">ğŸ†• æ–°æ¸¸æˆ</button>
                <button class="control-btn" onclick="pauseGame()" id="pauseBtn">â¸ï¸ æš‚åœ</button>
                <button class="control-btn" onclick="showHelp()">â“ å¸®åŠ©</button>
            </div>
        </div>
    </div>

    <div class="achievement-popup" id="achievementPopup">
        <div class="achievement-title" id="achievementTitle">ğŸ† æˆå°±è§£é”ï¼</div>
        <div class="achievement-desc" id="achievementDesc">æ­å–œè¾¾æˆæ–°æˆå°±ï¼</div>
        <button class="control-btn" onclick="closeAchievement()">âœ… ç¡®å®š</button>
    </div>

    <script>
        console.log('ğŸ¯ è““è““çš„å°„ç®­æŒ‘æˆ˜æ¸¸æˆåˆå§‹åŒ–å¼€å§‹...');

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            arrows: 10,
            score: 0,
            hits: 0,
            shots: 0,
            level: 1,
            isPaused: false,
            isAiming: false,
            power: 0,
            powerDirection: 1,
            windForce: 0,
            windDirection: 1,
            targetX: 0,
            targetY: 0,
            isMovingTarget: false
        };

        // æˆå°±ç³»ç»Ÿ
        const achievements = {
            firstHit: { unlocked: false, title: 'ğŸ¯ åˆæ¬¡å‘½ä¸­', desc: 'å°„ä¸­ç¬¬ä¸€ä¸ªç›®æ ‡ï¼' },
            bullseye: { unlocked: false, title: 'ğŸ’– çº¢å¿ƒé«˜æ‰‹', desc: 'å°„ä¸­10æ¬¡çº¢å¿ƒï¼' },
            perfectShot: { unlocked: false, title: 'ğŸ¹ ç¥å°„æ‰‹', desc: 'è¿ç»­5æ¬¡å‘½ä¸­ï¼' },
            windMaster: { unlocked: false, title: 'ğŸ’¨ é£ä¹‹æŒæ§è€…', desc: 'åœ¨å¼ºé£ä¸­å‘½ä¸­ç›®æ ‡ï¼' },
            levelUp: { unlocked: false, title: 'ğŸ“ˆ è¿›é˜¶å°„æ‰‹', desc: 'è¾¾åˆ°5çº§ï¼' }
        };

        let streakCount = 0;
        let bullseyeCount = 0;

        // éŸ³é¢‘ä¸Šä¸‹æ–‡
        let audioContext;

        console.log('æ¸¸æˆçŠ¶æ€åˆå§‹åŒ–å®Œæˆ', gameState);

        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                console.log('éŸ³é¢‘ä¸Šä¸‹æ–‡åˆå§‹åŒ–æˆåŠŸ');
            } catch (e) {
                console.warn('éŸ³é¢‘ä¸æ”¯æŒ:', e);
            }
        }

        function playSound(type) {
            if (!audioContext) return;

            console.log('æ’­æ”¾éŸ³æ•ˆ:', type);
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            switch (type) {
                case 'shoot':
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.3);
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                    break;
                case 'hit':
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                    break;
                case 'bullseye':
                    [800, 1000, 1200].forEach((freq, i) => {
                        const osc = audioContext.createOscillator();
                        const gain = audioContext.createGain();
                        osc.connect(gain);
                        gain.connect(audioContext.destination);
                        osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.1);
                        gain.gain.setValueAtTime(0.1, audioContext.currentTime + i * 0.1);
                        gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.1 + 0.3);
                        osc.start(audioContext.currentTime + i * 0.1);
                        osc.stop(audioContext.currentTime + i * 0.1 + 0.3);
                    });
                    break;
                case 'miss':
                    oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.08, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.5);
                    break;
            }
        }

        function initGame() {
            console.log('ğŸ¯ åˆå§‹åŒ–å°„ç®­æ¸¸æˆ...');
            initAudio();
            
            // è®¾ç½®åˆå§‹ç›®æ ‡ä½ç½®
            positionTarget();
            
            // è®¾ç½®é£åŠ›
            updateWind();
            
            // ç»‘å®šäº‹ä»¶
            setupEventListeners();
            
            // å¼€å§‹æ¸¸æˆå¾ªç¯
            gameLoop();
            
            updateUI();
            console.log('âœ… å°„ç®­æ¸¸æˆåˆå§‹åŒ–å®Œæˆ!');
        }

        function setupEventListeners() {
            console.log('è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
            const gameArea = document.getElementById('gameArea');
            
            // é¼ æ ‡äº‹ä»¶
            gameArea.addEventListener('mousedown', startAiming);
            gameArea.addEventListener('mouseup', shoot);
            gameArea.addEventListener('mousemove', updateAiming);
            
            // è§¦æ‘¸äº‹ä»¶
            gameArea.addEventListener('touchstart', handleTouch);
            gameArea.addEventListener('touchend', handleTouchEnd);
            gameArea.addEventListener('touchmove', handleTouchMove);
            
            console.log('äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
        }

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            startAiming(mouseEvent);
        }

        function handleTouchEnd(e) {
            e.preventDefault();
            shoot();
        }

        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            updateAiming(mouseEvent);
        }

        function startAiming(e) {
            if (gameState.isPaused || gameState.arrows <= 0) return;
            
            console.log('ğŸ¯ å¼€å§‹ç„å‡†...');
            gameState.isAiming = true;
            gameState.power = 0;
            gameState.powerDirection = 1;
            
            const crosshair = document.getElementById('crosshair');
            crosshair.style.opacity = '1';
            
            updateCrosshair(e);
            startPowerMeter();
        }

        function updateAiming(e) {
            if (!gameState.isAiming) return;
            
            updateCrosshair(e);
            updateTrajectory(e);
            
            // å­˜å‚¨ç„å‡†ç‚¹ï¼Œè€Œä¸æ˜¯ç›´æ¥ç”¨äºå‘½ä¸­åˆ¤å®š
            const rect = document.getElementById('gameArea').getBoundingClientRect();
            gameState.aimX = e.clientX - rect.left;
            gameState.aimY = e.clientY - rect.top;
        }

        function updateCrosshair(e) {
            const crosshair = document.getElementById('crosshair');
            const rect = document.getElementById('gameArea').getBoundingClientRect();
            
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            crosshair.style.left = (x - 15) + 'px';
            crosshair.style.top = (y - 15) + 'px';
        }

        function updateTrajectory(e) {
            const trajectoryLine = document.getElementById('trajectoryLine');
            const rect = document.getElementById('gameArea').getBoundingClientRect();
            const bow = document.getElementById('bow');
            const bowRect = bow.getBoundingClientRect();
            
            const startX = bowRect.left + bowRect.width/2 - rect.left;
            const startY = bowRect.top + bowRect.height/2 - rect.top;
            const endX = e.clientX - rect.left;
            const endY = e.clientY - rect.top;
            
            const deltaX = endX - startX;
            const deltaY = endY - startY;
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            
            trajectoryLine.style.left = startX + 'px';
            trajectoryLine.style.top = startY + 'px';
            trajectoryLine.style.width = Math.min(distance, 200) + 'px';
            trajectoryLine.style.transform = `rotate(${angle}deg)`;
            trajectoryLine.style.opacity = '0.7';
        }

        function startPowerMeter() {
            console.log('ğŸ”¥ å¼€å§‹åŠ›åº¦è®¡ç®—...');
            const powerInterval = setInterval(() => {
                if (!gameState.isAiming) {
                    clearInterval(powerInterval);
                    return;
                }
                
                gameState.power += gameState.powerDirection * 2;
                
                if (gameState.power >= 100) {
                    gameState.power = 100;
                    gameState.powerDirection = -1;
                } else if (gameState.power <= 0) {
                    gameState.power = 0;
                    gameState.powerDirection = 1;
                }
                
                document.getElementById('powerFill').style.width = gameState.power + '%';
            }, 50);
        }

        function shoot() {
            if (!gameState.isAiming || gameState.arrows <= 0) return;
            
            console.log('ğŸ¹ å°„ç®­!', {
                power: gameState.power,
                windForce: gameState.windForce,
                arrows: gameState.arrows,
                aimPoint: { x: gameState.aimX, y: gameState.aimY }
            });
            
            gameState.isAiming = false;
            gameState.arrows--;
            gameState.shots++;
            
            const crosshair = document.getElementById('crosshair');
            const trajectoryLine = document.getElementById('trajectoryLine');
            crosshair.style.opacity = '0';
            trajectoryLine.style.opacity = '0';
            
            // åˆ›å»ºç®­çŸ¢åŠ¨ç”»ï¼Œä¼ é€’ç„å‡†ç‚¹
            createArrow(gameState.aimX, gameState.aimY);
            
            playSound('shoot');
            updateUI();
            
            // æ£€æŸ¥æ¸¸æˆç»“æŸ
            if (gameState.arrows <= 0) {
                setTimeout(() => {
                    console.log('ğŸ® æ¸¸æˆç»“æŸ');
                    alert(`æ¸¸æˆç»“æŸï¼\næœ€ç»ˆåˆ†æ•°: ${gameState.score}\nå‘½ä¸­ç‡: ${Math.round((gameState.hits/gameState.shots)*100)}%`);
                }, 1000);
            }
        }

        function createArrow(aimX, aimY) {
            console.log('ğŸ¹ åˆ›å»ºç®­çŸ¢åŠ¨ç”»ï¼Œä½¿ç”¨çœŸå®ç„å‡†ç‚¹:', { aimX, aimY });
            const bow = document.getElementById('bow');
            const gameArea = document.getElementById('gameArea');
            
            const arrow = document.createElement('div');
            arrow.className = 'arrow';
            
            const bowRect = bow.getBoundingClientRect();
            const gameRect = gameArea.getBoundingClientRect();
            
            const startX = bowRect.left + bowRect.width/2 - gameRect.left;
            const startY = bowRect.top + bowRect.height/2 - gameRect.top;
            
            // ä½¿ç”¨ä¼ å…¥çš„ç„å‡†ç‚¹ä½œä¸ºç›®æ ‡ï¼Œè€Œä¸æ˜¯åå­—å…‰æ ‡ä½ç½®
            const endX = aimX - gameRect.left;
            const endY = aimY - gameRect.top;
            
            arrow.style.left = startX + 'px';
            arrow.style.top = startY + 'px';
            
            const deltaX = endX - startX;
            const deltaY = endY - startY;
            const angle = Math.atan2(deltaY, deltaX) * 180 / Math.PI;
            arrow.style.transform = `rotate(${angle}deg)`;
            
            gameArea.appendChild(arrow);
            
            // åº”ç”¨é£åŠ›å½±å“ - åŸºäºè·ç¦»å’Œé£åŠ›å¼ºåº¦
            const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
            const windEffect = gameState.windForce * gameState.windDirection * (distance / 500); // é£åŠ›åŸºäºè·ç¦»
            const finalX = endX + windEffect;
            const finalY = endY;
            
            console.log('ğŸ¯ ç®­çŸ¢è½¨è¿¹è®¡ç®—:', {
                start: { x: startX, y: startY },
                aim: { x: endX, y: endY },
                final: { x: finalX, y: finalY },
                windEffect,
                distance
            });
            
            // åŠ¨ç”»åˆ°ç›®æ ‡ä½ç½® - å‡æ…¢ç®­çŸ¢é€Ÿåº¦ï¼Œæ›´å®¹æ˜“çœ‹åˆ°
            arrow.style.transition = 'all 1.2s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            arrow.style.left = finalX + 'px';
            arrow.style.top = finalY + 'px';
            
            // æ£€æŸ¥å‘½ä¸­
            setTimeout(() => {
                checkHit(finalX, finalY);
                arrow.remove();
            }, 1200);
        }

        function checkHit(arrowX, arrowY) {
            console.log('ğŸ¯ æ£€æŸ¥å‘½ä¸­...');
            const target = document.getElementById('target');
            const targetRect = target.getBoundingClientRect();
            const gameRect = document.getElementById('gameArea').getBoundingClientRect();
            
            const targetCenterX = targetRect.left + targetRect.width/2 - gameRect.left;
            const targetCenterY = targetRect.top + targetRect.height/2 - gameRect.top;
            
            const distance = Math.sqrt(
                Math.pow(arrowX - targetCenterX, 2) + 
                Math.pow(arrowY - targetCenterY, 2)
            );
            
            console.log('å‘½ä¸­æ£€æµ‹:', {
                arrowPos: { x: arrowX, y: arrowY },
                targetCenter: { x: targetCenterX, y: targetCenterY },
                distance: distance
            });
            
            let points = 0;
            let hitType = '';
            
            if (distance <= 25) {
                // çº¢å¿ƒ - æ‰©å¤§å‘½ä¸­èŒƒå›´
                points = 100;
                hitType = 'bullseye';
                bullseyeCount++;
                streakCount++;
                playSound('bullseye');
                createParticles(targetCenterX, targetCenterY, '#ff1493');
                console.log('ğŸ¯ çº¢å¿ƒå‘½ä¸­!', { points, bullseyeCount });
                
                if (bullseyeCount >= 10) {
                    unlockAchievement('bullseye');
                }
            } else if (distance <= 45) {
                // å†…ç¯ - æ‰©å¤§å‘½ä¸­èŒƒå›´
                points = 50;
                hitType = 'inner';
                streakCount++;
                playSound('hit');
                createParticles(targetCenterX, targetCenterY, '#ff69b4');
                console.log('ğŸ¯ å†…ç¯å‘½ä¸­!', { points });
            } else if (distance <= 65) {
                // å¤–ç¯ - æ‰©å¤§å‘½ä¸­èŒƒå›´
                points = 25;
                hitType = 'outer';
                streakCount++;
                playSound('hit');
                createParticles(targetCenterX, targetCenterY, '#ffb6c1');
                console.log('ğŸ¯ å¤–ç¯å‘½ä¸­!', { points });
            } else {
                // è„±é¶
                hitType = 'miss';
                streakCount = 0;
                playSound('miss');
                console.log('âŒ è„±é¶!');
            }
            
            if (points > 0) {
                gameState.hits++;
                gameState.score += points;
                
                // æ˜¾ç¤ºå¾—åˆ†
                showScorePopup(arrowX, arrowY, points);
                
                // æ£€æŸ¥ç¬¬ä¸€æ¬¡å‘½ä¸­æˆå°±
                if (gameState.hits === 1) {
                    unlockAchievement('firstHit');
                }
                
                // æ£€æŸ¥è¿å‡»æˆå°±
                if (streakCount >= 5) {
                    unlockAchievement('perfectShot');
                }
                
                // æ£€æŸ¥é£åŠ›æˆå°±
                if (Math.abs(gameState.windForce) >= 3 && points > 0) {
                    unlockAchievement('windMaster');
                }
                
                // å‡çº§æ£€æŸ¥
                const newLevel = Math.floor(gameState.score / 500) + 1;
                if (newLevel > gameState.level) {
                    gameState.level = newLevel;
                    console.log('ğŸ“ˆ ç­‰çº§æå‡!', { newLevel });
                    
                    if (gameState.level >= 5) {
                        unlockAchievement('levelUp');
                    }
                    
                    // å¢åŠ éš¾åº¦
                    gameState.isMovingTarget = gameState.level >= 3;
                    updateTargetMovement();
                }
            }
            
            updateUI();
            positionTarget();
            updateWind();
        }

        function showScorePopup(x, y, points) {
            console.log('æ˜¾ç¤ºå¾—åˆ†å¼¹çª—:', { x, y, points });
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = '+' + points;
            popup.style.left = x + 'px';
            popup.style.top = y + 'px';
            
            document.getElementById('gameArea').appendChild(popup);
            
            setTimeout(() => popup.remove(), 2000);
        }

        function createParticles(x, y, color) {
            console.log('åˆ›å»ºç²’å­ç‰¹æ•ˆ:', { x, y, color });
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.background = color;
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                
                const angle = (i / 8) * Math.PI * 2;
                const distance = 30 + Math.random() * 20;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;
                
                particle.style.setProperty('--dx', dx + 'px');
                particle.style.setProperty('--dy', dy + 'px');
                
                document.getElementById('gameArea').appendChild(particle);
                
                setTimeout(() => particle.remove(), 1000);
            }
        }

        function positionTarget() {
            console.log('ğŸ¯ é‡æ–°å®šä½ç›®æ ‡...');
            const target = document.getElementById('target');
            const gameArea = document.getElementById('gameArea');
            const gameRect = gameArea.getBoundingClientRect();
            
            // ç¡®ä¿ç›®æ ‡åœ¨å³ä¾§åŒºåŸŸ
            const minX = gameRect.width * 0.6;
            const maxX = gameRect.width - 120;
            const minY = 50;
            const maxY = gameRect.height - 150;
            
            gameState.targetX = minX + Math.random() * (maxX - minX);
            gameState.targetY = minY + Math.random() * (maxY - minY);
            
            target.style.left = gameState.targetX + 'px';
            target.style.top = gameState.targetY + 'px';
            
            console.log('ç›®æ ‡æ–°ä½ç½®:', { x: gameState.targetX, y: gameState.targetY });
        }

        function updateTargetMovement() {
            const target = document.getElementById('target');
            
            if (gameState.isMovingTarget) {
                target.classList.add('moving');
                console.log('ğŸ¯ å¯ç”¨ç§»åŠ¨ç›®æ ‡');
            } else {
                target.classList.remove('moving');
                console.log('ğŸ¯ ç¦ç”¨ç§»åŠ¨ç›®æ ‡');
            }
        }

        function updateWind() {
            console.log('ğŸ’¨ æ›´æ–°é£åŠ›...');
            gameState.windForce = Math.random() * 2 - 1; // å‡å°‘é£åŠ›å½±å“ï¼š-1 åˆ° 1
            gameState.windDirection = gameState.windForce >= 0 ? 1 : -1;
            
            const windArrow = document.getElementById('windArrow');
            const windForceAbs = Math.abs(gameState.windForce);
            
            let windSymbol = '';
            if (windForceAbs < 0.3) {
                windSymbol = 'â—‹'; // æ— é£
            } else if (windForceAbs < 0.7) {
                windSymbol = gameState.windDirection > 0 ? 'â†’' : 'â†'; // å¾®é£
            } else {
                windSymbol = gameState.windDirection > 0 ? 'â‡’' : 'â‡'; // å¼ºé£
            }
            
            windArrow.textContent = windSymbol;
            windArrow.style.color = windForceAbs > 0.7 ? '#ff6347' : '#00bfff';
            
            console.log('é£åŠ›æ›´æ–°:', {
                force: gameState.windForce,
                direction: gameState.windDirection,
                symbol: windSymbol
            });
        }

        function unlockAchievement(achievementKey) {
            const achievement = achievements[achievementKey];
            if (achievement.unlocked) return;
            
            console.log('ğŸ† è§£é”æˆå°±:', achievementKey, achievement);
            achievement.unlocked = true;
            
            document.getElementById('achievementTitle').textContent = achievement.title;
            document.getElementById('achievementDesc').textContent = achievement.desc;
            document.getElementById('achievementPopup').style.display = 'block';
        }

        function closeAchievement() {
            document.getElementById('achievementPopup').style.display = 'none';
        }

        function updateUI() {
            console.log('ğŸ”„ æ›´æ–°UI', gameState);
            
            document.getElementById('arrowsDisplay').textContent = gameState.arrows;
            document.getElementById('scoreDisplay').textContent = gameState.score;
            document.getElementById('hitsDisplay').textContent = gameState.hits;
            document.getElementById('levelDisplay').textContent = gameState.level;
            
            const accuracy = gameState.shots > 0 ? Math.round((gameState.hits / gameState.shots) * 100) : 0;
            document.getElementById('accuracyDisplay').textContent = accuracy + '%';
            
            document.getElementById('powerFill').style.width = gameState.power + '%';
        }

        function newGame() {
            console.log('ğŸ†• å¼€å§‹æ–°æ¸¸æˆ...');
            gameState = {
                arrows: 10,
                score: 0,
                hits: 0,
                shots: 0,
                level: 1,
                isPaused: false,
                isAiming: false,
                power: 0,
                powerDirection: 1,
                windForce: 0,
                windDirection: 1,
                targetX: 0,
                targetY: 0,
                isMovingTarget: false
            };
            
            streakCount = 0;
            bullseyeCount = 0;
            
            // é‡ç½®æˆå°±
            Object.keys(achievements).forEach(key => {
                achievements[key].unlocked = false;
            });
            
            positionTarget();
            updateWind();
            updateTargetMovement();
            updateUI();
            
            console.log('âœ… æ–°æ¸¸æˆå¼€å§‹!');
        }

        function pauseGame() {
            gameState.isPaused = !gameState.isPaused;
            const pauseBtn = document.getElementById('pauseBtn');
            
            console.log('â¸ï¸ æ¸¸æˆæš‚åœçŠ¶æ€:', gameState.isPaused);
            
            if (gameState.isPaused) {
                pauseBtn.textContent = 'â–¶ï¸ ç»§ç»­';
            } else {
                pauseBtn.textContent = 'â¸ï¸ æš‚åœ';
            }
        }

        function showHelp() {
            alert(`ğŸ¯ è““è““çš„å°„ç®­æŒ‘æˆ˜ - æ¸¸æˆè¯´æ˜

ğŸ® æ“ä½œæ–¹æ³•:
â€¢ é¼ æ ‡æŒ‰ä¸‹å¼€å§‹ç„å‡†
â€¢ ç§»åŠ¨é¼ æ ‡è°ƒæ•´æ–¹å‘
â€¢ æ¾å¼€é¼ æ ‡å°„ç®­

ğŸ¯ å¾—åˆ†è§„åˆ™:
â€¢ çº¢å¿ƒ ğŸ’–: 100åˆ†
â€¢ å†…ç¯: 50åˆ†  
â€¢ å¤–ç¯: 25åˆ†

ğŸ’¨ æ¸¸æˆè¦ç´ :
â€¢ æ³¨æ„é£åŠ›å½±å“ç®­çŸ¢è½¨è¿¹
â€¢ 3çº§åç›®æ ‡ä¼šç§»åŠ¨
â€¢ è¿ç»­å‘½ä¸­è·å¾—æ›´é«˜åˆ†æ•°

ğŸ† æˆå°±ç³»ç»Ÿ:
â€¢ é¦–æ¬¡å‘½ä¸­ã€çº¢å¿ƒé«˜æ‰‹
â€¢ ç¥å°„æ‰‹ã€é£ä¹‹æŒæ§è€…ç­‰

ç¥ä½ æ¸¸æˆæ„‰å¿«ï¼ğŸ’–`);
        }

        function gameLoop() {
            // æ¸¸æˆä¸»å¾ªç¯ - ç›®å‰ä¸»è¦ç”¨äºæœªæ¥æ‰©å±•
            requestAnimationFrame(gameLoop);
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        console.log('ğŸš€ å¼€å§‹åˆå§‹åŒ–å°„ç®­æ¸¸æˆ...');
        document.addEventListener('DOMContentLoaded', initGame);
        
        // å¦‚æœDOMå·²åŠ è½½å®Œæˆ
        if (document.readyState === 'loading') {
            console.log('â³ ç­‰å¾…DOMåŠ è½½...');
        } else {
            console.log('ğŸ“± DOMå·²å°±ç»ªï¼Œç«‹å³åˆå§‹åŒ–');
            initGame();
        }

        console.log('âœ… è““è““çš„å°„ç®­æŒ‘æˆ˜è„šæœ¬åŠ è½½å®Œæˆ!');
    </script>
</body>
</html>
